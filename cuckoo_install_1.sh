#!/bin/bash
#Program: 
# This program is used to install cuckoo 

# Reference site:
# https://cuckoo.sh/docs/installation/host/installation.html
# https://stackoverflow.com/questions/41407396/is-gui-for-android-sdk-manager-gone
# https://github.com/idanr1986/cuckoo-droid/blob/master/README.md


# (Optional)
#sudo apt -y install snap
#sudo snap install vscode --classic
#sudo apt -y install vim

# install git
#sudo apt -y install git
#git config --global user.email "b02901043@ntu.edu.tw"
#git config --global user.name "Nmlab137"

# cuckoo droid easy integration
cd ~
git clone --depth=1 https://github.com/cuckoobox/cuckoo.git cuckoo -b 1.2
cd cuckoo
git remote add droid https://github.com/idanr1986/cuckoo-droid
git pull --no-edit -s recursive -X theirs droid master 
cat conf-extra/processing.conf >> conf/processing.conf
cat conf-extra/reporting.conf >> conf/reporting.conf
rm -r conf-extra
echo "protobuf" >> requirements.txt

# Download dependencies
sudo apt-get -y install python python-pip python-dev libffi-dev libssl-dev
sudo apt-get -y install mongodb
#sudo apt-get -y install python-virtualenv python-setuptools
#sudo apt-get -y install libjpeg-dev zlib1g-dev swig
#sudo apt-get -y install postgresql libpq-dev
sudo apt-get -y update
sudo apt-get -y install libfuzzy-dev
# (Optional) Install Yara
# (Optional) Install Pydeep
#git clone https://github.com/kbandla/pydeep.git

# install KVM, XenAPI(optional)
sudo apt-get -y install qemu-kvm libvirt-bin ubuntu-vm-builder bridge-utils python-libvirt
sudo pip install XenAPI

# upgrade pip
sudo pip install --upgrade pip
sudo pip install -r requirements.txt

# install tcpdump
sudo apt-get -y install tcpdump
sudo apt-get -y install libcap2-bin 
sudo setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump
sudo chmod +s /usr/sbin/tcpdump
# Print setting
# getcap /usr/sbin/tcpdump

# install M2Crypto
sudo apt-get -y install swig
sudo -H pip install m2crypto==0.24.0

# install dependency for cuckoo droid
sudo apt-get -y install openjdk-8-jre libstdc++6:i386 libgcc1:i386 zlib1g:i386 libncurses5:i386

# Download android sdk 24.4.1
cd ~
wget http://dl.google.com/android/android-sdk_r24.4.1-linux.tgz
tar -xvf android-sdk_r24.4.1-linux.tgz
rm *.tgz
cd android-sdk-linux/tools/
#./android

#>>> Install sdk packages
# List all available packages
# ./android list sdk --all
# install packages
echo yes|./android update sdk --no-ui --all --filter 1,2,3,58,150,151,199
cd ~
#cd android-sdk-linux/tools/

#>>> Export path 
export PATH=$PATH:/home/vb/android-sdk-linux/tools:/home/vb/android-sdk-linux/build-tools/28.0.3/:/home/vb/android-sdk-linux/platform-tools
cd ~




